C51 COMPILER V8.08   PWM_出LED显示                                                        08/19/2015 12:48:49 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE PWM_出LED显示
OBJECT MODULE PLACED IN PWM输出LED显示.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE PWM输出LED显示.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**************************************************************************/
   2          
   3                    //-----------------直流电机PWM调速实验程序----------------//
   4          
   5          //测试单片机：STC89C52
   6          
   7          //晶振：11.0592M （外部）
   8          
   9          //复位方式：内部复位
  10                            
  11          //调试环境：KEIL3
  12          
  13          //硬件测试环境：使用“清翔电子”单片机开发板测试通过
  14          
  15          //程序功能： PWM也就是脉宽调制，是指在周期脉冲信号频率不变的情况下，改变高电平
  16          //
  17          //                       和低电平的比例，也就是改变占空比。PWM在灯具调光，直流电机调速方面
  18          //
  19          //                       有着广泛的应用。程序使用定时器0中断模拟PWM定时，S2、S3 两个独立按 
  20          //
  21          //                       键控制电机速度，为使演示结果明显，PWM输出
  22          //
  23          //                   到整个P1接口，通过板上的LED灯可以看到亮度的变化。
  24          //
  25          /****************************************************************************/  
  26          
  27          #include <reg51.h>
  28          
  29          typedef unsigned char uint8;
  30          typedef unsigned int  uint16;
  31          
  32          sbit down = P3^0;
  33          sbit up = P3^1;
  34          
  35          uint8 t = 0;
  36          uint8 PWM_T = 0;   //占空比控制变
  37          
  38          void delay_1ms(uint16 t)
  39          {
  40   1              uint16 x,y;
  41   1              for(x=t;x>0;x--)
  42   1                      for(y=120;y>0;y--);
  43   1      }
  44          
  45          
  46                    
  47          /****************************************************
  48                            主程序
  49          ****************************************************/
  50          void main(void)      
  51          {
  52   1      
  53   1              TMOD = 0x02;   //定时器0，工作模式2，8位定时模式
  54   1              TH0=210;     //写入预置初值（取值1-255，数越大PWM频率越高）
  55   1              TL0=210;     //写入预置值 （取值1-255，数越大PWM频率越高）
C51 COMPILER V8.08   PWM_出LED显示                                                        08/19/2015 12:48:49 PAGE 2   

  56   1              TR0=1;       //启动定时器
  57   1              ET0=1;       //允许定时器0中断
  58   1              EA=1;        //允许总中断
  59   1              P1=0xff;         //初始化P1，输出端口
  60   1              PWM_T=30;
  61   1               while(1)      
  62   1              
  63   1               {   
  64   2                       if(!up)
  65   2                              {
  66   3                                      if(PWM_T<250)
  67   3                                              {
  68   4                                                PWM_T++;
  69   4                                              }
  70   3                                      
  71   3                                      delay_1ms(10);
  72   3                              }
  73   2                       if(!down)
  74   2                              {
  75   3                                      if(PWM_T>0)
  76   3                                              {
  77   4                                                PWM_T--;
  78   4                                              }
  79   3                                      
  80   3                                      delay_1ms(10);
  81   3                              }
  82   2      
  83   2              
  84   2               }      
  85   1      }
  86          /****************************************************
  87                         /定时器0中断模拟PWM
  88          ****************************************************/
  89          timer0() interrupt 1  
  90          { 
  91   1               t++;    //每次定时器溢出加1
  92   1               
  93   1               if(t==250)   //PWM周期 100个单位
  94   1                       {
  95   2                                t=0;  //使t=0，开始新的PWM周期
  96   2                                P1=0x00;  //输出端口
  97   2                       }
  98   1               
  99   1               if(PWM_T==t)  //按照当前占空比切换输出为高电平
 100   1                       {  
 101   2                              P1=0xff;        //  
 102   2                       }
 103   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    121    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
