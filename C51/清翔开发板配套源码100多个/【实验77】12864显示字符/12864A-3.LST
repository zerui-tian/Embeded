C51 COMPILER V8.08   12864A_3                                                              08/18/2015 22:30:23 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE 12864A_3
OBJECT MODULE PLACED IN 12864A-3.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 12864A-3.c DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************************
   2          * 【编写时间】： 2014年3月5日
   3          * 【作    者】： 清翔电子:03
   4          * 【版    本】： 1.0
   5          * 【网    站】： http://www.qxmcu.com/ 
   6          * 【淘宝店铺】： http://qxmcu.taobao.com/ 
   7          * 【实验平台】： QX-MCS51 单片机开发板
   8          * 【外部晶振】： 11.0592mhz     
   9          * 【主控芯片】： STC89C52
  10          * 【编译环境】： Keil μVisio3  
  11          * 【程序功能】： 12864显示图形  液晶型号控制器是ST7920 其他液晶本程序不适用                                                                         
  12          * 【使用说明】： 如果发现液晶不显示请调节液晶对比度，如果是在本店购买的12864液晶
  13          本店会把对比度调节好接上去就可以显示，如果在本店购买的液晶无显示可以咨询我们客服
  14          
  15          *  说明：免费开源，不提供源代码分析.
  16          **********************************************************************************/
  17          
  18          #include <reg51.h>
  19          #include <intrins.h>
  20                  
  21          #define uchar unsigned char
  22          #define uint  unsigned int
  23          /*12864端口定义*/
  24          #define LCD_data  P0             //数据口
  25          sbit LCD_RS  =  P3^5;            //寄存器选择输入 
  26          sbit LCD_RW  =  P3^6;            //液晶读/写控制
  27          sbit LCD_EN  =  P3^4;            //液晶使能控制
  28          sbit LCD_PSB =  P3^1;            //串/并方式控制
  29          sbit wela    =  P2^6;
  30          sbit dula    =  P2^7;
  31          
  32          uchar code dis1[] = {"清翔电子"};
  33          uchar code dis2[] = {"。51单片机开发板"};
  34          uchar code dis3[] = {"一起学习单片机"};
  35          uchar code dis4[] = {"。是您最好的选择 "};
  36          
  37          #define delayNOP(); {_nop_();_nop_();_nop_();_nop_();};
  38          uchar IRDIS[2];
  39          uchar IRCOM[4];
  40          void beep();
  41          void  dataconv();
  42          void lcd_pos(uchar X,uchar Y);  //确定显示位置
  43          /*******************************************************************/
  44          /*                                                                 */
  45          /*  延时函数                                                       */
  46          /*                                                                 */
  47          /*******************************************************************/
  48          void delay(int ms)
  49          {
  50   1          while(ms--)
  51   1              {
  52   2            uchar i;
  53   2                for(i=0;i<250;i++)  
  54   2                 {
  55   3                  _nop_();                       
C51 COMPILER V8.08   12864A_3                                                              08/18/2015 22:30:23 PAGE 2   

  56   3                      _nop_();
  57   3                      _nop_();
  58   3                      _nop_();
  59   3                 }
  60   2              }
  61   1      }               
  62          /*******************************************************************/
  63          /*                                                                 */
  64          /*检查LCD忙状态                                                    */
  65          /*lcd_busy为1时，忙，等待。lcd-busy为0时,闲，可写指令与数据。      */
  66          /*                                                                 */
  67          /*******************************************************************/
  68          bit lcd_busy()
  69           {                          
  70   1          bit result;
  71   1          LCD_RS = 0;
  72   1          LCD_RW = 1;
  73   1          LCD_EN = 1;
  74   1          delayNOP();
  75   1          result = (bit)(P0&0x80);
  76   1          LCD_EN = 0;
  77   1          return(result); 
  78   1       }
  79          /*******************************************************************/
  80          /*                                                                 */
  81          /*写指令数据到LCD                                                  */
  82          /*RS=L，RW=L，E=高脉冲，D0-D7=指令码。                             */
  83          /*                                                                 */
  84          /*******************************************************************/
  85          void lcd_wcmd(uchar cmd)
  86          {                          
  87   1         while(lcd_busy());
  88   1          LCD_RS = 0;
  89   1          LCD_RW = 0;
  90   1          LCD_EN = 0;
  91   1          _nop_();
  92   1          _nop_(); 
  93   1          P0 = cmd;
  94   1          delayNOP();
  95   1          LCD_EN = 1;
  96   1          delayNOP();
  97   1          LCD_EN = 0;  
  98   1      }
  99          /*******************************************************************/
 100          /*                                                                 */
 101          /*写显示数据到LCD                                                  */
 102          /*RS=H，RW=L，E=高脉冲，D0-D7=数据。                               */
 103          /*                                                                 */
 104          /*******************************************************************/
 105          void lcd_wdat(uchar dat)
 106          {                          
 107   1         while(lcd_busy());
 108   1          LCD_RS = 1;
 109   1          LCD_RW = 0;
 110   1          LCD_EN = 0;
 111   1          P0 = dat;
 112   1          delayNOP();
 113   1          LCD_EN = 1;
 114   1          delayNOP();
 115   1          LCD_EN = 0; 
 116   1      }
 117          /*******************************************************************/
C51 COMPILER V8.08   12864A_3                                                              08/18/2015 22:30:23 PAGE 3   

 118          /*                                                                 */
 119          /*  LCD初始化设定                                                  */
 120          /*                                                                 */
 121          /*******************************************************************/
 122          void lcd_init()
 123          { 
 124   1      
 125   1          LCD_PSB = 1;         //并口方式
 126   1          
 127   1          lcd_wcmd(0x34);      //扩充指令操作
 128   1          delay(5);
 129   1          lcd_wcmd(0x30);      //基本指令操作
 130   1          delay(5);
 131   1          lcd_wcmd(0x0C);      //显示开，关光标
 132   1          delay(5);
 133   1          lcd_wcmd(0x01);      //清除LCD的显示内容
 134   1          delay(5);
 135   1      }
 136          /*********************************************************/
 137          /*                                                                                                               */
 138          /* 主程序                                                                                */
 139          /*                                                       */
 140          /*********************************************************/
 141            main()
 142           {
 143   1          uchar i;
 144   1          delay(10);                 //延时
 145   1          wela=0;
 146   1              dula=0; 
 147   1          lcd_init();                //初始化LCD             
 148   1        
 149   1          lcd_pos(0,0);             //设置显示位置为第一行的第1个字符
 150   1           i = 0;
 151   1          while(dis1[i] != '\0')
 152   1           {                         //显示字符
 153   2             lcd_wdat(dis1[i]);
 154   2             i++;
 155   2           }
 156   1          lcd_pos(1,0);             //设置显示位置为第二行的第1个字符
 157   1           i = 0;
 158   1          while(dis2[i] != '\0')
 159   1           {
 160   2             lcd_wdat(dis2[i]);      //显示字符
 161   2             i++;
 162   2           }
 163   1               lcd_pos(2,0);             //设置显示位置为第三行的第1个字符
 164   1           i = 0;
 165   1          while(dis3[i] != '\0')
 166   1           {
 167   2             lcd_wdat(dis3[i]);      //显示字符
 168   2             i++;
 169   2           }
 170   1               lcd_pos(3,0);             //设置显示位置为第四行的第1个字符
 171   1           i = 0;
 172   1          while(dis4[i] != '\0')
 173   1           {
 174   2             lcd_wdat(dis4[i]);      //显示字符
 175   2             i++;
 176   2           }
 177   1           while(1);
 178   1      }
 179          
C51 COMPILER V8.08   12864A_3                                                              08/18/2015 22:30:23 PAGE 4   

 180          
 181          /*********************************************************/
 182          /*                                                       */
 183          /* 设定显示位置                                          */
 184          /*                                                       */
 185          /*********************************************************/
 186          void lcd_pos(uchar X,uchar Y)
 187          {                          
 188   1         uchar  pos;
 189   1         if (X==0)
 190   1           {X=0x80;}
 191   1         else if (X==1)
 192   1           {X=0x90;}
 193   1         else if (X==2)
 194   1           {X=0x88;}
 195   1         else if (X==3)
 196   1           {X=0x98;}
 197   1         pos = X+Y ;  
 198   1         lcd_wcmd(pos);     //显示地址
 199   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    284    ----
   CONSTANT SIZE    =     59    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
