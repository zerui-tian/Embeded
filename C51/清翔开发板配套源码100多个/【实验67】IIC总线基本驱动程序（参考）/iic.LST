C51 COMPILER V8.08   IIC                                                                   08/18/2015 21:40:16 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE IIC
OBJECT MODULE PLACED IN iic.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE iic.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************************
   2          * 【编写时间】： 2014年3月5日
   3          * 【作    者】： 清翔电子:03
   4          * 【版    本】： 1.0
   5          * 【网    站】： http://www.qxmcu.com/ 
   6          * 【淘宝店铺】： http://qxmcu.taobao.com/ 
   7          * 【实验平台】： QX-MCS51 单片机开发板
   8          * 【外部晶振】： 11.0592mhz     
   9          * 【主控芯片】： STC89C52
  10          * 【编译环境】： Keil μVisio3  
  11          * 【程序功能】： 为IIC总线的基本驱动程序（此程序没有写主函数，只是一些IIC必备的子函数）
  12                           所以下载到开发板上后没有任何效果                                                                                   
  13          * 【使用说明】： 
  14          *  说明：免费开源，不提供源代码分析.
  15          **********************************************************************************/
  16          
  17          #include<reg51.h>
  18          #include <intrins.h>
  19          #define uint unsigned int
  20          #define uchar unsigned char
  21          sbit sda=P2^0;                          //IO口定义
  22          sbit scl=P2^1;
  23          
  24          void nop()
  25          {
  26   1              _nop_();
  27   1              _nop_();
  28   1      }
  29          /////////24C02读写驱动程序////////////////////
  30          void delay1(unsigned int m)
  31          {       unsigned int n;
  32   1              for(n=0;n<m;n++);
  33   1      }
  34          
  35          void init()  //24c02初始化子程序
  36          {
  37   1              scl=1;
  38   1              nop();
  39   1              sda=1;
  40   1              nop();
  41   1      }
  42          
  43          void start()        //启动I2C总线
  44          {
  45   1              sda=1;
  46   1              nop();
  47   1              scl=1;
  48   1              nop();
  49   1              sda=0;
  50   1              nop();
  51   1              scl=0;
  52   1              nop();
  53   1      }
  54          
  55          void stop()         //停止I2C总线
C51 COMPILER V8.08   IIC                                                                   08/18/2015 21:40:16 PAGE 2   

  56          {
  57   1              sda=0;
  58   1              nop();
  59   1              scl=1;
  60   1              nop();
  61   1              sda=1;
  62   1              nop();
  63   1      }
  64          
  65          void writebyte(unsigned char j)  //写一个字节
  66          {
  67   1              unsigned char i,temp;
  68   1              temp=j;
  69   1              for (i=0;i<8;i++)
  70   1         {
  71   2                 temp=temp<<1;
  72   2                 scl=0;
  73   2                 nop();
  74   2                 sda=CY;              //temp左移时，移出的值放入了CY中
  75   2                 nop();
  76   2                 scl=1;               //待sda线上的数据稳定后，将scl拉高
  77   2                 nop();
  78   2         }
  79   1         scl=0;
  80   1         nop();
  81   1         sda=1;
  82   1         nop();
  83   1      }
  84          
  85          unsigned char readbyte()   //读一个字节
  86          {
  87   1         unsigned char i,j,k=0;
  88   1         scl=0; nop(); sda=1;
  89   1         for (i=0;i<8;i++)
  90   1         {  
  91   2                      nop(); scl=1; nop();
  92   2              if(sda==1) 
  93   2                      j=1;
  94   2              else
  95   2                      j=0;
  96   2              k=(k<<1)|j;
  97   2                      scl=0;
  98   2              }
  99   1              nop();
 100   1              return(k);
 101   1      }
 102          
 103          void clock()         //I2C总线时钟
 104          {
 105   1         unsigned char i=0;
 106   1         scl=1;
 107   1         nop();
 108   1         while((sda==1)&&(i<255))
 109   1                i++;
 110   1         scl=0;
 111   1         nop();
 112   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    154    ----
   CONSTANT SIZE    =   ----    ----
C51 COMPILER V8.08   IIC                                                                   08/18/2015 21:40:16 PAGE 3   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
